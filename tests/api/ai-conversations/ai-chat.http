###
### ü§ñ M√ìDULO DE CONVERSACIONES IA - ¬°YA IMPLEMENTADO!
### Chat inteligente con Gemini API multiempresa
###

# Variables del m√≥dulo
@baseUrl = http://localhost:3000/api
@tenantId = cmdhkxgb90000ogtg90akfgel

# üîë TOKEN - Reemplazar con token real despu√©s del login
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWRoa3hnZmEwMDAyb2d0Z2N0M2pqcnA3IiwiZW1haWwiOiJhZG1pbkB0ZW5hbnQuY29tIiwicm9sZSI6IkFETUlOIiwidGVuYW50SWQiOiJjbWRoa3hnYjkwMDAwb2d0ZzkwYWtmZ2VsIiwiaWF0IjoxNzUzNzIyOTM2LCJleHAiOjE3NTQzMjc3MzZ9.IoP_j7MD-lAlg2mTDYG-p29PItyzL9h3Uf1dwIvQXkg

# Variables de chat
@conversationId = CONVERSATION_ID_AQUI
@clientPhone = +1234567890
@messageId = MESSAGE_ID_AQUI

###############################################
### üîì OBTENER TOKEN PARA PRUEBAS
###############################################

### 1. LOGIN para obtener token
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@tenant.com",
  "password": "admin123"
}

###############################################
### üí¨ CHAT CON GEMINI AI - ¬°FUNCIONANDO!
###############################################

### 2. ENVIAR MENSAJE AL CHAT IA
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Hola, necesito ayuda con productos disponibles",
  "clientPhone": "{{clientPhone}}"
}

### 3. CHAT CON CONTEXTO DE CONVERSACI√ìN
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øQu√© laptops tienen disponibles?",
  "clientPhone": "{{clientPhone}}",
  "conversationId": "conv-12345"
}

### 4. CHAT CON CONTEXTO ADICIONAL
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øCu√°l me recomendar√≠as para programar?",
  "clientPhone": "{{clientPhone}}",
  "conversationId": "conv-12345",
  "context": ["Pregunt√≥ por laptops", "Est√° interesado en programaci√≥n"]
}

### 5. OBTENER HISTORIAL DE CONVERSACIONES
GET {{baseUrl}}/ai/conversations
Authorization: Bearer {{accessToken}}

### 6. OBTENER HISTORIAL LIMITADO
GET {{baseUrl}}/ai/conversations?limit=20
Authorization: Bearer {{accessToken}}

###############################################
### ‚öôÔ∏è CONFIGURACI√ìN DE BOT - ¬°FUNCIONANDO!
###############################################

### 7. OBTENER CONFIGURACI√ìN DEL BOT
GET {{baseUrl}}/ai/bot-config
Authorization: Bearer {{accessToken}}

### 8. ACTUALIZAR CONFIGURACI√ìN DEL BOT
PUT {{baseUrl}}/ai/bot-config
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "botName": "Asistente Virtual CommerceBot",
  "promptStyle": "Amigable, profesional y persuasivo para ventas",
  "greeting": "¬°Hola! Soy tu asistente virtual especializado en productos. ¬øEn qu√© puedo ayudarte hoy?",
  "temperature": 0.8,
  "useImages": true
}

### 9. PROBAR CONFIGURACI√ìN DEL BOT
POST {{baseUrl}}/ai/bot-config/test
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "testMessage": "Hola, ¬øqu√© productos tienen disponibles para gaming?"
}

###############################################
### üß† EJEMPLOS DE CHAT AVANZADO
###############################################

### 10. CHAT SOBRE PRODUCTOS ESPEC√çFICOS
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Busco una laptop para programar, que tenga buena relaci√≥n precio-calidad",
  "clientPhone": "+1234567890",
  "conversationId": "programming-inquiry"
}

### 11. SEGUIMIENTO DE CONVERSACI√ìN
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øCu√°l de esos productos me recomendar√≠as m√°s?",
  "clientPhone": "+1234567890",
  "conversationId": "programming-inquiry"
}

###############################################
### üìä ANALYTICS DE CONVERSACIONES (FUTURO)
###############################################

### 12. ESTAD√çSTICAS DE CONVERSACIONES
GET {{baseUrl}}/ai/analytics/conversations
Authorization: Bearer {{accessToken}}

### 13. MENSAJES M√ÅS FRECUENTES
GET {{baseUrl}}/ai/analytics/frequent-messages
Authorization: Bearer {{accessToken}}

### 14. PRODUCTOS M√ÅS CONSULTADOS
GET {{baseUrl}}/ai/analytics/popular-products
Authorization: Bearer {{accessToken}}

### 15. TASA DE CONVERSI√ìN POR IA
GET {{baseUrl}}/ai/analytics/conversion-rate
Authorization: Bearer {{accessToken}}

###############################################
### üîÑ INTEGRACIONES (FUTURO)
###############################################

### 16. WEBHOOK DE WHATSAPP (RECIBIR)
POST {{baseUrl}}/ai/webhooks/whatsapp
Content-Type: application/json

{
  "from": "{{clientPhone}}",
  "message": "Hola, ¬øtienen productos disponibles?",
  "timestamp": "2024-01-01T12:00:00Z"
}

### 17. ENVIAR MENSAJE V√çA WHATSAPP
POST {{baseUrl}}/ai/send/whatsapp
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "to": "{{clientPhone}}",
  "message": "¬°Hola! Tenemos laptops en oferta. ¬øTe interesa?"
}

###############################################
### ‚ùå CASOS DE ERROR
###############################################

### 18. MENSAJE VAC√çO
POST {{baseUrl}}/ai/conversations/{{conversationId}}/messages
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "",
  "clientPhone": "{{clientPhone}}"
}

### 19. CONVERSACI√ìN INEXISTENTE
GET {{baseUrl}}/ai/conversations/id-inexistente
Authorization: Bearer {{accessToken}}

### 20. CONFIGURACI√ìN INV√ÅLIDA
PUT {{baseUrl}}/ai/bot-config
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "temperature": 2.0,
  "botName": ""
}

###############################################
### üìù ESPECIFICACIONES IMPLEMENTADAS
###############################################

# üéØ ENDPOINTS FUNCIONANDO:
# POST   /ai/chat                             - ‚úÖ Enviar mensaje al chat IA
# GET    /ai/conversations                    - ‚úÖ Obtener historial de conversaciones
# GET    /ai/bot-config                       - ‚úÖ Obtener configuraci√≥n del bot
# PUT    /ai/bot-config                       - ‚úÖ Actualizar configuraci√≥n del bot
# POST   /ai/bot-config/test                  - ‚úÖ Probar configuraci√≥n con mensaje

# ü§ñ FUNCIONALIDADES IA IMPLEMENTADAS:
# ‚úÖ Chat inteligente con Gemini Pro
# ‚úÖ Contexto de productos autom√°tico 
# ‚úÖ Respuestas contextuales con historial
# ‚úÖ Configuraci√≥n personalizable por tenant
# ‚úÖ Integraci√≥n con inventario de productos
# ‚úÖ Memoria de conversaciones por cliente

# üè¢ MULTIEMPRESA IMPLEMENTADO:
# ‚úÖ Configuraci√≥n de bot por tenant independiente
# ‚úÖ Historial separado por tenant (100% aislado)
# ‚úÖ Prompts personalizados por empresa
# ‚úÖ Contexto de productos espec√≠fico del tenant
# ‚úÖ Branding configurable (nombre, estilo, saludo)

# üîê SEGURIDAD IMPLEMENTADA:
# ‚úÖ JWT obligatorio en todos los endpoints
# ‚úÖ Aislamiento total por tenant
# ‚úÖ Validaciones robustas con DTOs
# ‚úÖ Manejo seguro de API keys de Gemini

# üîß CONFIGURACI√ìN REQUERIDA:
# - GEMINI_API_KEY en .env (obtener de Google AI Studio)
# - Base de datos con tablas: BotConfig, ChatHistory

# üìä FUNCIONALIDADES B√ÅSICAS:
# ‚úÖ Historial de conversaciones guardado
# ‚úÖ M√©tricas b√°sicas (tokens usados, timestamp)
# ‚úÖ Agrupaci√≥n por cliente/tel√©fono
# ‚úÖ L√≠mites configurables en consultas

# üîÆ PR√ìXIMAS MEJORAS (FUTURO):
# ‚è≥ Webhooks para WhatsApp/Telegram
# ‚è≥ Analytics avanzados y m√©tricas
# ‚è≥ Rate limiting por cliente
# ‚è≥ Respuestas con im√°genes
# ‚è≥ Integraci√≥n con m√°s LLMs (GPT, Claude) 