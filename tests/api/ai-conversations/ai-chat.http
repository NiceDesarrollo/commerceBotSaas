###
### ü§ñ M√ìDULO DE CONVERSACIONES IA - ¬°YA IMPLEMENTADO!
### Chat inteligente con Gemini API multiempresa
###

# Variables del m√≥dulo
@baseUrl = http://localhost:3000/api
@tenantId = cmdoq78720000ogiscz0rb3zt

# üîë TOKEN - Reemplazar con token real despu√©s del login
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWRvcWFvYXQwMDAyb2dpMGZra2ZwcmliIiwiZW1haWwiOiJhZG1pbkBmcmlraXBsYXphLmNvbSIsInJvbGUiOiJBRE1JTiIsInRlbmFudElkIjoiY21kb3FhbzVuMDAwMG9naTBhcnJja21xbCIsImlhdCI6MTc1MzgwNTI4MSwiZXhwIjoxNzU0NDEwMDgxfQ.467XUNCEgxKj_yu2PxAvJbbJSpcbW5Vv6j16efkZ2Lc

# Variables de chat
@conversationId = conv-1753805846416-qpffhmrw8
@clientPhone = +1234567890
@messageId = MESSAGE_ID_AQUI

###############################################
### üîì OBTENER TOKEN PARA PRUEBAS
###############################################

### 1. LOGIN para obtener token
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "admin@frikiplaza.com",
  "password": "admin123"
}

###############################################
### üéÆ SIMULACI√ìN DE PROSPECTO REAL - Alex (Estudiante Gamer)
### Presupuesto: $800-1200 | Juega: Valorant, CS2, LoL
###############################################

### 2. MENSAJE INICIAL - Consulta general
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Hola, soy estudiante universitario y quiero armar mi primer setup gaming serio. Tengo un presupuesto de unos $1000. ¬øQu√© me recomiendan?",
  "clientPhone": "+1555-ALEX-001"
}

### 3. ESPECIFICAR NECESIDADES - Juegos que juega
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Principalmente juego Valorant, CS2 y League of Legends. A veces alg√∫n juego AAA como el nuevo Spider-Man. Necesito que corra fluido en 1080p.",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 4. PREGUNTAR POR COMPONENTES ESPEC√çFICOS
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Me interesa mucho la RTX 4070 Super que mencionaste, pero est√° un poco fuera de mi presupuesto. ¬øHay algo m√°s econ√≥mico que me d√© buen rendimiento?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 5. NEGOCIACI√ìN - Buscar alternativas
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øY qu√© tal si compro solo algunos componentes ahora y otros m√°s adelante? ¬øQu√© es lo m√°s importante para empezar?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 6. CONSULTA T√âCNICA - Compatibilidad
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Si compro el procesador i7-13700K, ¬ønecesito una tarjeta gr√°fica espec√≠fica o puedo usar la que tengo por ahora?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 7. DECISI√ìN DE COMPRA - Perif√©ricos
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Ok, creo que voy con el procesador y un teclado mec√°nico. El Corsair K70 se ve genial. ¬øTienen descuentos si compro ambos?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 8. OBJECCI√ìN DE PRECIO - Comparaci√≥n
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Vi que en Amazon el mismo teclado est√° a $140. ¬øPueden igualar el precio o tienen alguna oferta especial?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 9. CONSULTA ADICIONAL - Servicio post-venta
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øQu√© garant√≠a tienen los productos? ¬øY si necesito ayuda para armar la PC?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

### 10. CIERRE DE VENTA - Confirmaci√≥n
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Perfecto, me convenciste. Quiero comprar el i7-13700K y el teclado Corsair. ¬øC√≥mo procedo con la compra?",
  "clientPhone": "+1555-ALEX-001",
  "conversationId": "{{conversationId}}"
}

###############################################
### üèÜ SIMULACI√ìN PROSPECTO AVANZADO - Maria (Streamer Pro)
### Presupuesto: $2000+ | Streaming + Gaming competitivo
###############################################

### 11. PROSPECTO PREMIUM - Necesidades profesionales
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Hola, soy streamer y necesito actualizar completamente mi setup. Hago streaming de gaming en 1440p y necesito que todo sea top tier. Presupuesto flexible.",
  "clientPhone": "+1555-MARIA-PRO"
}

### 12. REQUERIMIENTOS ESPEC√çFICOS
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Necesito dual monitor, uno ultrawide para jugar y otro normal para el chat. Tambi√©n quiero que todo tenga RGB coordinado. ¬øQu√© me sugieres?",
  "clientPhone": "+1555-MARIA-PRO",
  "conversationId": "conv-maria-streamer-setup"
}

###############################################
### üíî SIMULACI√ìN CLIENTE PERDIDO - Carlos (Precio sensible)
### Presupuesto muy limitado: $300-500
###############################################

### 13. CLIENTE CON PRESUPUESTO MUY BAJO
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Hola, quiero una PC gamer pero solo tengo $400. ¬øQu√© puedo conseguir con ese presupuesto?",
  "clientPhone": "+1555-CARLOS-LOW"
}

### 14. ESCALAMIENTO - Alternativas creativas
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "$400 es todo lo que tengo. ¬øNo tienen productos usados o alg√∫n plan de financiamiento?",
  "clientPhone": "+1555-CARLOS-LOW",
  "conversationId": "conv-carlos-budget"
}

###############################################
### üí¨ CHAT CON GEMINI AI - ¬°FUNCIONANDO!
###############################################

### 2. ENVIAR MENSAJE AL CHAT IA
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Hola, necesito ayuda con productos disponibles",
  "clientPhone": "{{clientPhone}}"
}

### 3. CHAT CON CONTEXTO DE CONVERSACI√ìN
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øQu√© laptops tienen disponibles?",
  "clientPhone": "{{clientPhone}}",
  "conversationId": "conv-1753805626978-2t9v0qqzs"
}

### 4. CHAT CON CONTEXTO ADICIONAL
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øCu√°l me recomendar√≠as para programar?",
  "clientPhone": "{{clientPhone}}",
  "conversationId": "conv-12345",
  "context": ["Pregunt√≥ por laptops", "Est√° interesado en programaci√≥n"]
}

### 5. OBTENER HISTORIAL DE CONVERSACIONES
GET {{baseUrl}}/ai/conversations
Authorization: Bearer {{accessToken}}

### 6. OBTENER HISTORIAL LIMITADO
GET {{baseUrl}}/ai/conversations?limit=20
Authorization: Bearer {{accessToken}}

###############################################
### ‚öôÔ∏è CONFIGURACI√ìN DE BOT - ¬°FUNCIONANDO!
###############################################

### 7. OBTENER CONFIGURACI√ìN DEL BOT
GET {{baseUrl}}/ai/bot-config
Authorization: Bearer {{accessToken}}

### 8. ACTUALIZAR CONFIGURACI√ìN DEL BOT
PUT {{baseUrl}}/ai/bot-config
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "botName": "Asistente Virtual CommerceBot",
  "promptStyle": "Amigable, profesional y persuasivo para ventas",
  "greeting": "¬°Hola! Soy tu asistente virtual especializado en productos. ¬øEn qu√© puedo ayudarte hoy?",
  "temperature": 0.8,
  "useImages": true
}

### 9. PROBAR CONFIGURACI√ìN DEL BOT
POST {{baseUrl}}/ai/bot-config/test
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "testMessage": "Hola, ¬øqu√© productos tienen disponibles para gaming?"
}

###############################################
### üß† EJEMPLOS DE CHAT AVANZADO
###############################################

### 10. CHAT SOBRE PRODUCTOS ESPEC√çFICOS
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "Busco una laptop para programar, que tenga buena relaci√≥n precio-calidad",
  "clientPhone": "+1234567890",
  "conversationId": "programming-inquiry"
}

### 11. SEGUIMIENTO DE CONVERSACI√ìN
POST {{baseUrl}}/ai/chat
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "¬øCu√°l de esos productos me recomendar√≠as m√°s?",
  "clientPhone": "+1234567890",
  "conversationId": "programming-inquiry"
}

###############################################
### üìä ANALYTICS DE CONVERSACIONES (FUTURO)
###############################################

### 12. ESTAD√çSTICAS DE CONVERSACIONES
GET {{baseUrl}}/ai/analytics/conversations
Authorization: Bearer {{accessToken}}

### 13. MENSAJES M√ÅS FRECUENTES
GET {{baseUrl}}/ai/analytics/frequent-messages
Authorization: Bearer {{accessToken}}

### 14. PRODUCTOS M√ÅS CONSULTADOS
GET {{baseUrl}}/ai/analytics/popular-products
Authorization: Bearer {{accessToken}}

### 15. TASA DE CONVERSI√ìN POR IA
GET {{baseUrl}}/ai/analytics/conversion-rate
Authorization: Bearer {{accessToken}}

###############################################
### üîÑ INTEGRACIONES (FUTURO)
###############################################

### 16. WEBHOOK DE WHATSAPP (RECIBIR)
POST {{baseUrl}}/ai/webhooks/whatsapp
Content-Type: application/json

{
  "from": "{{clientPhone}}",
  "message": "Hola, ¬øtienen productos disponibles?",
  "timestamp": "2024-01-01T12:00:00Z"
}

### 17. ENVIAR MENSAJE V√çA WHATSAPP
POST {{baseUrl}}/ai/send/whatsapp
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "to": "{{clientPhone}}",
  "message": "¬°Hola! Tenemos laptops en oferta. ¬øTe interesa?"
}

###############################################
### ‚ùå CASOS DE ERROR
###############################################

### 18. MENSAJE VAC√çO
POST {{baseUrl}}/ai/conversations/{{conversationId}}/messages
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "message": "",
  "clientPhone": "{{clientPhone}}"
}

### 19. CONVERSACI√ìN INEXISTENTE
GET {{baseUrl}}/ai/conversations/id-inexistente
Authorization: Bearer {{accessToken}}

### 20. CONFIGURACI√ìN INV√ÅLIDA
PUT {{baseUrl}}/ai/bot-config
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "temperature": 2.0,
  "botName": ""
}

###############################################
### üìù ESPECIFICACIONES IMPLEMENTADAS
###############################################

# üéØ ENDPOINTS FUNCIONANDO:
# POST   /ai/chat                             - ‚úÖ Enviar mensaje al chat IA
# GET    /ai/conversations                    - ‚úÖ Obtener historial de conversaciones
# GET    /ai/bot-config                       - ‚úÖ Obtener configuraci√≥n del bot
# PUT    /ai/bot-config                       - ‚úÖ Actualizar configuraci√≥n del bot
# POST   /ai/bot-config/test                  - ‚úÖ Probar configuraci√≥n con mensaje

# ü§ñ FUNCIONALIDADES IA IMPLEMENTADAS:
# ‚úÖ Chat inteligente con Gemini Pro
# ‚úÖ Contexto de productos autom√°tico 
# ‚úÖ Respuestas contextuales con historial
# ‚úÖ Configuraci√≥n personalizable por tenant
# ‚úÖ Integraci√≥n con inventario de productos
# ‚úÖ Memoria de conversaciones por cliente

# üè¢ MULTIEMPRESA IMPLEMENTADO:
# ‚úÖ Configuraci√≥n de bot por tenant independiente
# ‚úÖ Historial separado por tenant (100% aislado)
# ‚úÖ Prompts personalizados por empresa
# ‚úÖ Contexto de productos espec√≠fico del tenant
# ‚úÖ Branding configurable (nombre, estilo, saludo)

# üîê SEGURIDAD IMPLEMENTADA:
# ‚úÖ JWT obligatorio en todos los endpoints
# ‚úÖ Aislamiento total por tenant
# ‚úÖ Validaciones robustas con DTOs
# ‚úÖ Manejo seguro de API keys de Gemini

# üîß CONFIGURACI√ìN REQUERIDA:
# - GEMINI_API_KEY en .env (obtener de Google AI Studio)
# - Base de datos con tablas: BotConfig, ChatHistory

# üìä FUNCIONALIDADES B√ÅSICAS:
# ‚úÖ Historial de conversaciones guardado
# ‚úÖ M√©tricas b√°sicas (tokens usados, timestamp)
# ‚úÖ Agrupaci√≥n por cliente/tel√©fono
# ‚úÖ L√≠mites configurables en consultas

# üîÆ PR√ìXIMAS MEJORAS (FUTURO):
# ‚è≥ Webhooks para WhatsApp/Telegram
# ‚è≥ Analytics avanzados y m√©tricas
# ‚è≥ Rate limiting por cliente
# ‚è≥ Respuestas con im√°genes
# ‚è≥ Integraci√≥n con m√°s LLMs (GPT, Claude) 